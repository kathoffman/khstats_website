---
title: "Visualizing Timelines in R"
author: "Katherine Hoffman"
date: 2022-04-22T21:13:14-05:00
draft: false
categories: ["R","data visualization"]
tags: ["R","ggplot2","swimmer plots","treatment timelines","longitudinal survival"]
output: 
  html_document:
    toc: true
    toc_float: true
    smart: false
---



<blockquote>
<p>This post walks through code to create a timeline in <code>R</code> using <code>ggplot2</code>. These types of plots can help visualize <strong>treatment or measurement patterns</strong>, <strong>time-varying covariates</strong>, <strong>outcomes</strong>, and <strong>loss to follow-up</strong> in longitudinal data settings.</p>
</blockquote>
<figure>
<img src="/img/swimmer.jpg"
    width= 90%
         alt="Hospitalization course timeline using ggplot2 in R">
</figure>
<p>This blog post uses a toy dataset on hospitalized COVID-19 patients, available to download on my Github. It is derived from a real dataset compiled using Electronic Health Record data on COVID-19 patients from Spring 2020. This is a time period when there was large variation in provider practice in administering corticosteroids, a type of drug that combats hyper-inflammation.</p>
<p>In this post we will look at the treatment patterns of corticosteroids as it relates to the timing of patients (1) reaching severe hypoxia criteria and (2) being put on a ventilator. We will also include whether patients died or were discharged.</p>
<p>The data set is in long format with one row per patient. Let’s load the data set and libraries we’ll need, then look the first 20 rows:</p>
<pre class="r"><code>library(tidyverse)
library(gt)

dat_to_clean %&gt;%
  head(n=20) %&gt;%
  gt()</code></pre>
<div id="crdadrfsus" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#crdadrfsus .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#crdadrfsus .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#crdadrfsus .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#crdadrfsus .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#crdadrfsus .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#crdadrfsus .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#crdadrfsus .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#crdadrfsus .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#crdadrfsus .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#crdadrfsus .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#crdadrfsus .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#crdadrfsus .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#crdadrfsus .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#crdadrfsus .gt_from_md > :first-child {
  margin-top: 0;
}

#crdadrfsus .gt_from_md > :last-child {
  margin-bottom: 0;
}

#crdadrfsus .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#crdadrfsus .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#crdadrfsus .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#crdadrfsus .gt_row_group_first td {
  border-top-width: 2px;
}

#crdadrfsus .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#crdadrfsus .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#crdadrfsus .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#crdadrfsus .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#crdadrfsus .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#crdadrfsus .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#crdadrfsus .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#crdadrfsus .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#crdadrfsus .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#crdadrfsus .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#crdadrfsus .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#crdadrfsus .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#crdadrfsus .gt_left {
  text-align: left;
}

#crdadrfsus .gt_center {
  text-align: center;
}

#crdadrfsus .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#crdadrfsus .gt_font_normal {
  font-weight: normal;
}

#crdadrfsus .gt_font_bold {
  font-weight: bold;
}

#crdadrfsus .gt_font_italic {
  font-style: italic;
}

#crdadrfsus .gt_super {
  font-size: 65%;
}

#crdadrfsus .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#crdadrfsus .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#crdadrfsus .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#crdadrfsus .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#crdadrfsus .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">day</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">intubation_status</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">steroids</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">death</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">severe</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">3</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">5</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">7</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">11</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">12</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">13</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">14</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">15</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">16</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
    <tr><td class="gt_row gt_right">2</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">Not intubated</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td></tr>
  </tbody>
  
  
</table>
</div>
<p>If we look at the first patient, we can see they were in the hospital for 17 days, never intubated, never receive steroids, and ultimately die (<code>death</code> is <code>1</code> on the last day).</p>
<p>We can plot all patients’ hospital length of stay, colored by intubation status using <code>ggplot2</code>’s <code>geom_line()</code>:</p>
<pre class="r"><code>dat_to_clean %&gt;%
  ggplot(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_line()</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We can try to add our <code>steroids</code> column to the plot by adding a point designating whether <code>steroids</code> exposure was <code>1</code> (yes) or <code>0</code> (no) that day. We can see this results in points of two different colors on the lines of our plot.</p>
<pre class="r"><code>dat_to_clean %&gt;%
  ggplot(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_line() +
  geom_point(aes(day, id, col = steroids)) </code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>We could edit the colors of the dots we don’t want so that they’re transparent (using <code>NA</code>), but when you have other non-mutually exclusive dots you want to show, it’s simpler to just edit the data instead. We will edit our data so that our three binary columns are turned into three <code>*_this_day</code> column, where:</p>
<ul>
<li><p>The value is <code>NA</code> if the observation did not experience that exposure/outcome that day (remember each day is a new row)</p></li>
<li><p>The value is the <code>day</code> if the observation <em>did</em> experience the exposure/outcome. This is to make our <code>x</code> axis easy to specify in <code>ggplot2</code>.</p></li>
</ul>
<pre class="r"><code>dat_swim &lt;-
  dat_to_clean %&gt;%
  mutate(severe_this_day = case_when(severe == 1 ~ day),
         steroids_this_day = case_when(steroids == 1 ~ day),
         death_this_day = case_when(death == 1 ~ day))</code></pre>
<pre class="r"><code>dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;)) </code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe Hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;)) </code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Once all our data is on the graph, we can begin changing our color and shape scales. We can change colors using <code>scale_color_manual()</code> and and filling in the <code>values</code> argument with a vector where the <strong>names of the vector match the names in the <code>col</code> in our <code>geom_point()</code> aesthetics.</strong> I define my <code>cols</code> in a vector outside the plotting code to keep everything cleaner.</p>
<pre class="r"><code># define colors for all geometries with a color argument
cols &lt;- c(&quot;Death&quot; = &quot;black&quot;,
          &quot;Severe hypoxia&quot; = &quot;#b24745&quot;, # red
          &quot;Intubated&quot; = &quot;darkslateblue&quot;, # navy
          &quot;Not intubated&quot; = &quot;#74aaff&quot;, # lighter blue
          &quot;Steroids&quot;=&quot;#ffd966&quot;) # gold


dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;)) +
  scale_color_manual(values = cols, name=&quot;Patient Status&quot;) </code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-8-1.png" width="672" />
We can do the same to change shapes with <code>scale_shape_manual()</code>. To do this we additionally need to add the name to call the shape in the <code>geom_point(aes(shape=*))</code> argument.</p>
<pre class="r"><code># define shapes for all geometries with a shape argument (geom_point)
shapes &lt;- c(&quot;Steroids&quot; = 15, # square
            &quot;Death&quot; = 4, # cross
            &quot;Severe hypoxia&quot; = 21) # empty circle (control inside with fill argument if desired)


dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;, shape=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe hypoxia&quot;, shape=&quot;Severe hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;, shape=&quot;Death&quot;)) +
  scale_color_manual(values = cols, name=&quot;Patient Status&quot;) +
  scale_shape_manual(values = shapes, name=&quot;Patient Status&quot;)</code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>You’ll notice that our legend does not match the changes we made to the colors and shapes right now. This is because we’re breaking grammar of graphics (the “gg” of <code>ggplot2</code>) rules by assigning a bunch of different colors and shape. Although <code>ggplot2</code> wasn’t designed to do what we’re doing, we can override the legend aesthetics and still create a plot that shows correct and useful information.</p>
<p>We will do this by using the <code>guides()</code> function. We can control each aesthetic here. We will first override the <code>colors</code> legend with the code <code>guide_legend(override.aes = list(...))</code>. We can change the shapes by specifying a vector with the shapes we want in the order the labels appear in the legend. If we don’t want a shape to appear on the legend, we will use <code>NA</code>.</p>
<pre class="r"><code># define shapes for all geometries with a shape argument (geom_point)
shapes &lt;- c(&quot;Steroids&quot; = 15, # square
            &quot;Death&quot; = 4, # cross
            &quot;Severe hypoxia&quot; = 21) # empty circle (control inside with fill argument if desired)


dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;, shape=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe hypoxia&quot;, shape=&quot;Severe hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;, shape=&quot;Death&quot;)) +
  scale_color_manual(values = cols, name=&quot;Patient Status&quot;) +
  scale_shape_manual(values = shapes, name=&quot;Patient Status&quot;) +
  # order is death, hypoxia, intubated, not intubated, steorids
  guides(color = guide_legend(override.aes = list(shape = c(4,21,NA,NA,15))))# modify the color legend to include shapes</code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Since all the shapes are now shown in the original colors legend, we can hide the second legend for shapes using <code>shapes = F</code>.</p>
<pre class="r"><code>dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;, shape=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe hypoxia&quot;, shape=&quot;Severe hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;, shape=&quot;Death&quot;)) +
  scale_color_manual(values = cols, name=&quot;Patient Status&quot;) +
  scale_shape_manual(values = shapes, name=&quot;Patient Status&quot;) +
  # order is death, hypoxia, intubated, not intubated, steorids
  guides(color = guide_legend(override.aes = list(
    shape = c(4,21,NA,NA,15))), # modify the color legend to include shapes
         shape = F) # remove shape legend</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>To remove the line through Death, Severe hypoxia, and Steroids in our legend, we can override the aesthetics for <code>linetype</code> with NA’s for those three labels. We will specify the default, <code>linetype=1</code>, for our intubation status color labels.</p>
<pre class="r"><code>dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;, shape=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe hypoxia&quot;, shape=&quot;Severe hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;, shape=&quot;Death&quot;)) +
  scale_color_manual(values = cols, name=&quot;Patient Status&quot;) +
  scale_shape_manual(values = shapes, name=&quot;Patient Status&quot;) +
  # order is death, hypoxia, intubated, not intubated, steorids
  guides(color = guide_legend(override.aes = list(
    shape = c(4,21,NA,NA,15),
    linetype = c(NA,NA,1,1,NA))), # modify the color legend to include shapes
         shape = F)  # remove shape legend</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Ok, the challenging parts are done! Now we can make some minor aesthetic edits using theme.</p>
<pre class="r"><code>dat_swim %&gt;% 
  ggplot() +
  geom_line(aes(x=day, y=id, col = intubation_status, group=id)) +
  geom_point(aes(x=steroids_this_day, y=id, col=&quot;Steroids&quot;, shape=&quot;Steroids&quot;)) +
  geom_point(aes(x=severe_this_day, y=id, col=&quot;Severe hypoxia&quot;, shape=&quot;Severe hypoxia&quot;)) +
  geom_point(aes(x=death_this_day, y=id, col=&quot;Death&quot;, shape=&quot;Death&quot;)) +
  scale_color_manual(values = cols, name=&quot;Patient Status&quot;) +
  scale_shape_manual(values = shapes, name=&quot;Patient Status&quot;) +
  # order is death, hypoxia, intubated, not intubated, steorids
  guides(color = guide_legend(override.aes = list(
    shape = c(4,21,NA,NA,15),
    linetype = c(NA,NA,1,1,NA))), # modify the color legend to include shapes
         shape = F)  # remove shape legend</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<pre><code>## Warning: Removed 583 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 591 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 606 rows containing missing values (geom_point).</code></pre>
<p><img src="/blog/trt-timelines/advanced-techniques_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>dat_swim %&gt;%
  ggplot(aes(x = day, y = id, group = id, col = intubation_status)) +
  geom_line(linewidth=1.8, size=1.8)  +
  geom_point(shape = 15, size=.1) +
  geom_point(aes(steroids_this_day, id, col=&quot;Corticosteroids&quot;, shape=&quot;Corticosteroids&quot;),  stroke=2) +
  geom_point(aes(severe_this_day, id, col=&quot;Severe hypoxia&quot;,shape=&quot;Severe hypoxia&quot;),  stroke=1, size=2) +
  geom_point(aes(death_this_day,id,col=&quot;Death&quot;, shape=&quot;Death&quot;),  size=2, stroke=1.5) +
  scale_x_continuous(limits=c(0,28), minor_breaks=0:28, breaks=seq(0,28,2), expand=c(0,0)) +
  labs(x=&quot;Days since hospitalization&quot;, y=&quot;ID&quot;#y=&quot;Patient ID&quot;,
      # title=&quot;Hospitalization courses for N=50 patients&quot;
       ) +
  scale_y_discrete(labels=1:50)+
  theme_bw() +
  theme(text=element_text(family=&quot;Poppins&quot;, size=11),
        axis.title.y = element_text(angle = 0, vjust=.5, size=12, face=&quot;bold&quot;),
        #legend.spacing.y = unit(1, &#39;cm&#39;),
        axis.title.x = element_text(size=15, face=&quot;bold&quot;, vjust=-0.5, hjust=0),
        # axis.title.y = element_text(size=12, face=&quot;bold&quot;),
        legend.position = c(0.8, 0.24),
        legend.title = element_text(colour=&quot;black&quot;, size=13, face=4),
        legend.text = element_text(colour=&quot;black&quot;, size=10), #, face=&quot;bold&quot;)
        legend.background = element_rect(size=0.5, linetype=&quot;solid&quot;, colour =&quot;gray30&quot;),
        axis.ticks.y = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text.y = element_text(size=6, hjust=1.5)

  ) +
  scale_color_manual(name=&quot;Patient status&quot;,values=cols)+ # control colors
  scale_shape_manual(name=&quot;Patient status&quot;,values=shapes)   +
  # order is death, hypoxia, intubated, not intubated, steorids
  guides(color = guide_legend(override.aes = list(shape = c(4,21,NA,NA,15),
                                                  linetype = c(0,0,2,2,0), # controls whether there is a line thru legened
                                                  stroke=c(1.5,1,1,1,1),
                                                  size = c(2.5,2.5,2,2,2.5)),
                              ncol=1),
         shape = F)</code></pre>
