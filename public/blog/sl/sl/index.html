<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Katherine Hoffman">

  
  
  
    
  
  <meta name="description" content="Background In September 2019, I gave an R-Ladies NYC presentation about using the package sl3 to implement the superlearner algorithm for predictions. You can download the slides for it here. This post is a modification to the original demo I gave.
For a better background on what the superlearner algorithm is, please see my more recent blog post.
 Step 0: Load your libraries, set a seed, and load the data You’ll likely need to install sl3 from the tlverse github page, as it was not yet on CRAN at the time of writing this post.">

  
  <link rel="alternate" hreflang="en-us" href="https://khstats.com/blog/sl/sl/">

  


  

  
  
  
  <meta name="theme-color" content="#614f79">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.93ba0f8058c7a032bde93225bfbbb6b6.css">

  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-136820093-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://khstats.com/blog/sl/sl/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@rkatlady">
  <meta property="twitter:creator" content="@rkatlady">
  
  <meta property="og:site_name" content="KHstats">
  <meta property="og:url" content="https://khstats.com/blog/sl/sl/">
  <meta property="og:title" content="A short and sweet tutorial on using `sl3` for superlearning | KHstats">
  <meta property="og:description" content="Background In September 2019, I gave an R-Ladies NYC presentation about using the package sl3 to implement the superlearner algorithm for predictions. You can download the slides for it here. This post is a modification to the original demo I gave.
For a better background on what the superlearner algorithm is, please see my more recent blog post.
 Step 0: Load your libraries, set a seed, and load the data You’ll likely need to install sl3 from the tlverse github page, as it was not yet on CRAN at the time of writing this post."><meta property="og:image" content="https://khstats.com/img/icon-192.png">
  <meta property="twitter:image" content="https://khstats.com/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-09-12T21:13:14-05:00">
    
    <meta property="article:modified_time" content="2019-09-12T21:13:14-05:00">
  

  


  





  <title>A short and sweet tutorial on using `sl3` for superlearning | KHstats</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">KHstats</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#hero"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#blogs"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="https://scholar.google.com/citations?user=73RvTUoAAAAJ&amp;hl=en" target="_blank" rel="noopener"><span>Publications</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">A short and sweet tutorial on using `sl3` for superlearning</h1>

  

  
    



<meta content="2019-09-12 21:13:14 -0500 -0500" itemprop="datePublished">
<meta content="2019-09-12 21:13:14 -0500 -0500" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Sep 12, 2019</time>
  </span>
  

  

  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/r/">R</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://khstats.com/blog/sl/sl/&amp;text=A%20short%20and%20sweet%20tutorial%20on%20using%20%60sl3%60%20for%20superlearning" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://khstats.com/blog/sl/sl/&amp;t=A%20short%20and%20sweet%20tutorial%20on%20using%20%60sl3%60%20for%20superlearning" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=A%20short%20and%20sweet%20tutorial%20on%20using%20%60sl3%60%20for%20superlearning&amp;body=https://khstats.com/blog/sl/sl/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://khstats.com/blog/sl/sl/&amp;title=A%20short%20and%20sweet%20tutorial%20on%20using%20%60sl3%60%20for%20superlearning" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=A%20short%20and%20sweet%20tutorial%20on%20using%20%60sl3%60%20for%20superlearning%20https://khstats.com/blog/sl/sl/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://khstats.com/blog/sl/sl/&amp;title=A%20short%20and%20sweet%20tutorial%20on%20using%20%60sl3%60%20for%20superlearning" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<div id="background" class="section level1">
<h1>Background</h1>
<p>In September 2019, I gave an R-Ladies NYC presentation about using the package <code>sl3</code> to implement the superlearner algorithm for predictions. You can download the slides for it <a href="https://github.com/hoffmakl/sl3-demo/raw/master/superlearning_slides_no_animation.pdf">here</a>. This post is a modification to the original demo I gave.</p>
<p>For a better background on what the superlearner algorithm is, please see my more <a href="khstats.com/blog/sl/sl">recent blog post</a>.</p>
</div>
<div id="step-0-load-your-libraries-set-a-seed-and-load-the-data" class="section level1">
<h1>Step 0: Load your libraries, set a seed, and load the data</h1>
<p>You’ll likely need to install <code>sl3</code> from the <code>tlverse</code> github page, as it was not yet on CRAN at the time of writing this post.</p>
<pre class="r"><code>#devtools::install_github(&quot;tlverse/sl3&quot;)
library(sl3)
library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(kableExtra)</code></pre>
<pre><code>## 
## Attaching package: &#39;kableExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     group_rows</code></pre>
<pre class="r"><code>set.seed(7)</code></pre>
<p>We will use the same WASH Benefits data set as the TLverse does in their <a href="https://tlverse.org/tlverse-handbook/">Hitchhiker’s Guide</a>. We will be predicting children in rural Kenya and Bengladesh’s weight to height z-scores.</p>
<pre class="r"><code>washb_data &lt;- read.csv(&quot;https://raw.githubusercontent.com/tlverse/tlverse-data/master/wash-benefits/washb_data.csv&quot;)</code></pre>
<pre class="r"><code>kable(head(washb_data))</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right;">
whz
</th>
<th style="text-align:left;">
tr
</th>
<th style="text-align:left;">
fracode
</th>
<th style="text-align:right;">
month
</th>
<th style="text-align:right;">
aged
</th>
<th style="text-align:left;">
sex
</th>
<th style="text-align:right;">
momage
</th>
<th style="text-align:left;">
momedu
</th>
<th style="text-align:right;">
momheight
</th>
<th style="text-align:left;">
hfiacat
</th>
<th style="text-align:right;">
Nlt18
</th>
<th style="text-align:right;">
Ncomp
</th>
<th style="text-align:right;">
watmin
</th>
<th style="text-align:right;">
elec
</th>
<th style="text-align:right;">
floor
</th>
<th style="text-align:right;">
walls
</th>
<th style="text-align:right;">
roof
</th>
<th style="text-align:right;">
asset_wardrobe
</th>
<th style="text-align:right;">
asset_table
</th>
<th style="text-align:right;">
asset_chair
</th>
<th style="text-align:right;">
asset_khat
</th>
<th style="text-align:right;">
asset_chouki
</th>
<th style="text-align:right;">
asset_tv
</th>
<th style="text-align:right;">
asset_refrig
</th>
<th style="text-align:right;">
asset_bike
</th>
<th style="text-align:right;">
asset_moto
</th>
<th style="text-align:right;">
asset_sewmach
</th>
<th style="text-align:right;">
asset_mobile
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N05265
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
268
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
146.40
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.16
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N05265
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
286
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
148.75
</td>
<td style="text-align:left;">
Moderately Food Insecure
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.05
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N08002
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
264
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
152.15
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.26
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N08002
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
252
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
140.25
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.59
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N06531
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
336
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
Secondary (&gt;5y)
</td>
<td style="text-align:right;">
150.95
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.51
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N06531
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
304
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
Secondary (&gt;5y)
</td>
<td style="text-align:right;">
154.20
</td>
<td style="text-align:left;">
Severely Food Insecure
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="step-1-specify-outcome-and-predictors" class="section level1">
<h1>Step 1: Specify outcome and predictors</h1>
<p>We need the columns for the outcome and predictors to be specified as strings.</p>
<pre class="r"><code>outcome &lt;- &quot;whz&quot;
covars &lt;- washb_data %&gt;%
  select(-whz) %&gt;%
  names()</code></pre>
</div>
<div id="step-2-make-an-sl3-task" class="section level1">
<h1>Step 2: Make an sl3 task</h1>
<p>This is the object we’ll use whenever we want to fit a statistical model in <code>sl3</code>.</p>
<pre class="r"><code>washb_task &lt;- make_sl3_Task(
  data = washb_data,
  covariates = covars,
  outcome = outcome
)</code></pre>
<pre><code>## Warning in process_data(data, nodes, column_names = column_names, flag = flag, :
## Missing covariate data detected: imputing covariates.</code></pre>
<p>Note that we can’t have missing data in most statistical learning algorithms, so <code>sl3</code>’s default pre-processing imputes at the median and adds a column for missingness (in case the missingness is informative).</p>
<pre class="r"><code>washb_task</code></pre>
<pre><code>## A sl3 Task with 4695 obs and these nodes:
## $covariates
##  [1] &quot;tr&quot;              &quot;fracode&quot;         &quot;month&quot;           &quot;aged&quot;           
##  [5] &quot;sex&quot;             &quot;momage&quot;          &quot;momedu&quot;          &quot;momheight&quot;      
##  [9] &quot;hfiacat&quot;         &quot;Nlt18&quot;           &quot;Ncomp&quot;           &quot;watmin&quot;         
## [13] &quot;elec&quot;            &quot;floor&quot;           &quot;walls&quot;           &quot;roof&quot;           
## [17] &quot;asset_wardrobe&quot;  &quot;asset_table&quot;     &quot;asset_chair&quot;     &quot;asset_khat&quot;     
## [21] &quot;asset_chouki&quot;    &quot;asset_tv&quot;        &quot;asset_refrig&quot;    &quot;asset_bike&quot;     
## [25] &quot;asset_moto&quot;      &quot;asset_sewmach&quot;   &quot;asset_mobile&quot;    &quot;delta_momage&quot;   
## [29] &quot;delta_momheight&quot;
## 
## $outcome
## [1] &quot;whz&quot;
## 
## $id
## NULL
## 
## $weights
## NULL
## 
## $offset
## NULL
## 
## $time
## NULL</code></pre>
<div id="an-aside-exploring-sl3s-many-options" class="section level2">
<h2>An aside: Exploring <code>sl3</code>’s many options</h2>
<p>There’s a ton of different aspects of model fitting <code>sl3</code> has the capabilities to address. For example, we can look into algorithms for when the outcome is binomial, categorical, or continuous. There are also options for when you have clustered data, or if you need to preprocess/screen your data before implementing base learners.</p>
<pre class="r"><code>sl3_list_properties()</code></pre>
<pre><code>##  [1] &quot;binomial&quot;             &quot;categorical&quot;          &quot;continuous&quot;          
##  [4] &quot;cv&quot;                   &quot;density&quot;              &quot;ids&quot;                 
##  [7] &quot;multivariate_outcome&quot; &quot;offset&quot;               &quot;preprocessing&quot;       
## [10] &quot;sampling&quot;             &quot;screener&quot;             &quot;timeseries&quot;          
## [13] &quot;weights&quot;              &quot;wrapper&quot;</code></pre>
<p>We can learn more about each of these properties on this <a href="https://tlverse.org/sl3/reference/index.html">reference page</a>.</p>
</div>
<div id="another-aside-looking-at-available-learners" class="section level2">
<h2>Another aside: looking at available “learners”</h2>
<p>We’ll need to pick out base learners for our stack, as well as pick a metalearner. Since we are trying to predict z-scores, a continuous variable, let’s look at our potential learners for a continuous variable.</p>
<pre class="r"><code>sl3_list_learners(&quot;continuous&quot;) </code></pre>
<pre><code>##  [1] &quot;Lrnr_arima&quot;                     &quot;Lrnr_bartMachine&quot;              
##  [3] &quot;Lrnr_bilstm&quot;                    &quot;Lrnr_bound&quot;                    
##  [5] &quot;Lrnr_caret&quot;                     &quot;Lrnr_cv_selector&quot;              
##  [7] &quot;Lrnr_dbarts&quot;                    &quot;Lrnr_earth&quot;                    
##  [9] &quot;Lrnr_expSmooth&quot;                 &quot;Lrnr_gam&quot;                      
## [11] &quot;Lrnr_gbm&quot;                       &quot;Lrnr_glm&quot;                      
## [13] &quot;Lrnr_glm_fast&quot;                  &quot;Lrnr_glmnet&quot;                   
## [15] &quot;Lrnr_grf&quot;                       &quot;Lrnr_gts&quot;                      
## [17] &quot;Lrnr_h2o_glm&quot;                   &quot;Lrnr_h2o_grid&quot;                 
## [19] &quot;Lrnr_hal9001&quot;                   &quot;Lrnr_HarmonicReg&quot;              
## [21] &quot;Lrnr_hts&quot;                       &quot;Lrnr_lstm&quot;                     
## [23] &quot;Lrnr_mean&quot;                      &quot;Lrnr_multiple_ts&quot;              
## [25] &quot;Lrnr_nnet&quot;                      &quot;Lrnr_nnls&quot;                     
## [27] &quot;Lrnr_optim&quot;                     &quot;Lrnr_pkg_SuperLearner&quot;         
## [29] &quot;Lrnr_pkg_SuperLearner_method&quot;   &quot;Lrnr_pkg_SuperLearner_screener&quot;
## [31] &quot;Lrnr_polspline&quot;                 &quot;Lrnr_randomForest&quot;             
## [33] &quot;Lrnr_ranger&quot;                    &quot;Lrnr_rpart&quot;                    
## [35] &quot;Lrnr_rugarch&quot;                   &quot;Lrnr_screener_corP&quot;            
## [37] &quot;Lrnr_screener_corRank&quot;          &quot;Lrnr_screener_randomForest&quot;    
## [39] &quot;Lrnr_solnp&quot;                     &quot;Lrnr_stratified&quot;               
## [41] &quot;Lrnr_svm&quot;                       &quot;Lrnr_tsDyn&quot;                    
## [43] &quot;Lrnr_xgboost&quot;</code></pre>
<p>You’ll notice each learner starts with <code>Lrnr</code> and seems to correspond to a package in <code>R</code>.</p>
</div>
</div>
<div id="step-3-choosing-the-base-learners" class="section level1">
<h1>Step 3: Choosing the base learners</h1>
<p>Let’s pick just a few base learners to match the examples in my slides: a random forest, a generalized boosting model, and a generalized linear model. Let’s keep their default parameters for now.</p>
<p><code>make_learner_stack()</code> is an easy way to create a stack of default baselearners. It takes the names of the learners as strings and you’re good to go!</p>
<pre class="r"><code>stack &lt;- make_learner_stack(
  &quot;Lrnr_randomForest&quot;, 
  &quot;Lrnr_gbm&quot;,
  &quot;Lrnr_glm&quot;
)</code></pre>
</div>
<div id="step-4-choose-a-metalearner" class="section level1">
<h1>Step 4: Choose a metalearner</h1>
<p>There are many models we can choose from but we’ll keep it simple and use a generalized linear model. We are again using the <code>make_learner()</code> function.</p>
<pre class="r"><code>metalearner &lt;- make_learner(Lrnr_glm)</code></pre>
</div>
<div id="step-5-make-a-superlearner-object" class="section level1">
<h1>Step 5: Make a superlearner object</h1>
<p>Remember, under-the-hood <code>Lrnr_sl</code> takes the cross-validated predictions from the base models and uses them to predict the true outcome. That prediction model then is used to fit the predictions from base learners fit on the whole data set.</p>
<pre class="r"><code>sl &lt;- make_learner(Lrnr_sl, 
                   learners = stack,
                   metalearner = metalearner)</code></pre>
<p>A superlearner object has different functions built into it, such as <code>train()</code>. We can train our superlearner shell model on the task we made earlier.</p>
</div>
<div id="step-6-train-your-superlearner" class="section level1">
<h1>Step 6: Train your superlearner</h1>
<pre class="r"><code>sl_fit &lt;- sl$train(washb_task)</code></pre>
</div>
<div id="step-7-examine-the-results-of-the-superlearner" class="section level1">
<h1>Step 7: Examine the results of the superlearner</h1>
<div id="examine-coefficients-and-cv-risk" class="section level2">
<h2>Examine coefficients and CV-risk</h2>
<p>The default risk is MSE (Mean Squared Error). The coefficients show you how the metalearner decided to weight each base model for the final ensemble.</p>
<pre class="r"><code>sl_fit$print() %&gt;% kable() %&gt;% kable_styling(c(&quot;striped&quot;,&quot;condensed&quot;,&quot;hover&quot;))</code></pre>
<pre><code>## [1] &quot;SuperLearner:&quot;
## List of 3
##  $ : chr &quot;Lrnr_randomForest_100_TRUE_5_NULL_FALSE&quot;
##  $ : chr &quot;Lrnr_gbm_10000_2_0.001&quot;
##  $ : chr &quot;Lrnr_glm_TRUE&quot;
## [1] &quot;Lrnr_glm_TRUE&quot;
## $coefficients
##                               intercept Lrnr_randomForest_100_TRUE_5_NULL_FALSE 
##                             -0.02963258                              0.14284515 
##                  Lrnr_gbm_10000_2_0.001                           Lrnr_glm_TRUE 
##                              0.76258172                              0.04483759 
## 
## $R
##                                         intercept
## intercept                               -68.52007
## Lrnr_randomForest_100_TRUE_5_NULL_FALSE   0.00000
## Lrnr_gbm_10000_2_0.001                    0.00000
## Lrnr_glm_TRUE                             0.00000
##                                         Lrnr_randomForest_100_TRUE_5_NULL_FALSE
## intercept                                                              39.92453
## Lrnr_randomForest_100_TRUE_5_NULL_FALSE                               -22.47096
## Lrnr_gbm_10000_2_0.001                                                  0.00000
## Lrnr_glm_TRUE                                                           0.00000
##                                         Lrnr_gbm_10000_2_0.001 Lrnr_glm_TRUE
## intercept                                             40.15707     40.178684
## Lrnr_randomForest_100_TRUE_5_NULL_FALSE              -14.07995    -13.324068
## Lrnr_gbm_10000_2_0.001                                10.73357     10.531102
## Lrnr_glm_TRUE                                          0.00000     -8.635815
## 
## $rank
## [1] 4
## 
## $family
## 
## Family: gaussian 
## Link function: identity 
## 
## 
## $deviance
## [1] 4713.707
## 
## $aic
## [1] 13352.5
## 
## $null.deviance
## [1] 5000.347
## 
## $iter
## [1] 2
## 
## $df.residual
## [1] 4691
## 
## $df.null
## [1] 4694
## 
## $converged
## [1] TRUE
## 
## $boundary
## [1] FALSE
## 
## $linkinv_fun
## function (eta) 
## eta
## &lt;environment: namespace:stats&gt;
## 
## $link_fun
## function (mu) 
## mu
## &lt;environment: namespace:stats&gt;
## 
## $training_offset
## [1] FALSE
## 
## [1] &quot;Cross-validated risk (MSE, squared error loss):&quot;
##                                    learner coefficients     risk         se
## 1: Lrnr_randomForest_100_TRUE_5_NULL_FALSE   0.14284515 1.033374 0.02410610
## 2:                  Lrnr_gbm_10000_2_0.001   0.76258172 1.004980 0.02339719
## 3:                           Lrnr_glm_TRUE   0.04483759 1.019541 0.02381864
## 4:                            SuperLearner           NA 1.003984 0.02342457
##       fold_sd fold_min_risk fold_max_risk
## 1: 0.06111117     0.9192775      1.142474
## 2: 0.05877559     0.9064479      1.094319
## 3: 0.06093410     0.9113599      1.109910
## 4: 0.05928355     0.9027668      1.098435</code></pre>
<table class="table table-striped table-condensed table-hover" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
learner
</th>
<th style="text-align:right;">
coefficients
</th>
<th style="text-align:right;">
risk
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
fold_sd
</th>
<th style="text-align:right;">
fold_min_risk
</th>
<th style="text-align:right;">
fold_max_risk
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Lrnr_randomForest_100_TRUE_5_NULL_FALSE
</td>
<td style="text-align:right;">
0.1428451
</td>
<td style="text-align:right;">
1.033374
</td>
<td style="text-align:right;">
0.0241061
</td>
<td style="text-align:right;">
0.0611112
</td>
<td style="text-align:right;">
0.9192775
</td>
<td style="text-align:right;">
1.142474
</td>
</tr>
<tr>
<td style="text-align:left;">
Lrnr_gbm_10000_2_0.001
</td>
<td style="text-align:right;">
0.7625817
</td>
<td style="text-align:right;">
1.004980
</td>
<td style="text-align:right;">
0.0233972
</td>
<td style="text-align:right;">
0.0587756
</td>
<td style="text-align:right;">
0.9064479
</td>
<td style="text-align:right;">
1.094319
</td>
</tr>
<tr>
<td style="text-align:left;">
Lrnr_glm_TRUE
</td>
<td style="text-align:right;">
0.0448376
</td>
<td style="text-align:right;">
1.019541
</td>
<td style="text-align:right;">
0.0238186
</td>
<td style="text-align:right;">
0.0609341
</td>
<td style="text-align:right;">
0.9113599
</td>
<td style="text-align:right;">
1.109910
</td>
</tr>
<tr>
<td style="text-align:left;">
SuperLearner
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.003985
</td>
<td style="text-align:right;">
0.0234246
</td>
<td style="text-align:right;">
0.0592835
</td>
<td style="text-align:right;">
0.9027668
</td>
<td style="text-align:right;">
1.098435
</td>
</tr>
</tbody>
</table>
</div>
<div id="look-at-the-predictions" class="section level2">
<h2>Look at the predictions</h2>
<p><code>predict()</code> allows you to see what the model predicts on any given task. Here we look at predictions from the same data we trained the superlearner on, so the predicted weight to height z-scores of the first six children in our data set.</p>
<pre class="r"><code>sl_fit$predict(washb_task) %&gt;% head()</code></pre>
<pre><code>## [1] -0.6314652 -0.8016432 -0.7227981 -0.7663563 -0.6393717 -0.6628241</code></pre>
</div>
</div>
<div id="extras" class="section level1">
<h1>Extras</h1>
<ul>
<li><p>Cross validate your entire ensembled superlearner using the cross-validation package <code>origami</code>, written by the same authors as <code>sl3</code>. Or just hold out a testing data set to evaluate performance.</p></li>
<li><p>Use <code>make_learner()</code> to customize the tuning parameters of your base learners or metalearner. Ex: <code>lrnr_RF_200trees &lt;- make_lrnr(Lrnr_randomForest, ntree = 200)</code></p></li>
<li><p>Add many layers to your superlearner and organize it into a “pipeline”</p></li>
</ul>
<p><strong>For more demos, check out the following teaching materials from the authors of <code>sl3</code>.</strong> My tutorial uses one of their example data sets in case you’d like to extend your learning via their training resources.</p>
<ul>
<li><p><a href="https://tlverse.org/tlverse-handbook/ensemble-machine-learning.html" class="uri">https://tlverse.org/tlverse-handbook/ensemble-machine-learning.html</a></p></li>
<li><p><a href="https://tlverse.org/acic2019-workshop/ensemble-machine-learning.html" class="uri">https://tlverse.org/acic2019-workshop/ensemble-machine-learning.html</a></p></li>
<li><p><a href="https://github.com/tlverse/sl3_lecture" class="uri">https://github.com/tlverse/sl3_lecture</a></p></li>
</ul>
</div>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_huc473e5d783e956425af2298567207379_1878707_250x250_fill_q90_lanczos_center.jpeg" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://khstats.com/">Katherine Hoffman</a></h5>
      <h6 class="card-subtitle">Research Biostatistician</h6>
      <p class="card-text" itemprop="description">I am passionate about meaningful, reproducible medical research.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
          <li>
            <a itemprop="sameAs" href="mailto:kathoffman.stats@gmail.com" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/rkatlady" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/hoffmakl" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/talk/power-sims/">Power Simulations in R</a></li>
          
          <li><a href="/talk/lightning-talk/">Fireproof Your Computer from Jenny Bryan</a></li>
          
          <li><a href="/blog/ditl-biostats/">A Day in the Life of a Biostatistician</a></li>
          
          <li><a href="/blog/headers/headers-in-functions/">Outputting Rmarkdown Headers within Functions</a></li>
          
          <li><a href="/blog/dplyr/data-wrangling/">Data Wrangling with dplyr</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
